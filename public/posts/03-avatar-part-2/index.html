<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Pixel avatar Part 2: Displaying points in 3D · Martin&#39;s inner Cosmos
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Martin Kuzma">
<meta name="description" content="In the previous part, I extracted depth data from a HEIC file taken with an iPhone 15. Now I need to figure out how to display it as a pixelated 3D avatar on my blog.
Spoiler: I did and you can see the live demo at the bottom of this post.

  Options for Displaying Points
  
    
    Link to heading
  

What I want to achieve:

Display 100-2000 points
Animate the points to create a dynamic effect
Each point should have a color sampled from the original image
Have a jittering motion to give a lively appearance
Be capable of transitioning between different models smoothly

There are several approaches I could take to display points:">
<meta name="keywords" content="">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Pixel avatar Part 2: Displaying points in 3D">
  <meta name="twitter:description" content="In the previous part, I extracted depth data from a HEIC file taken with an iPhone 15. Now I need to figure out how to display it as a pixelated 3D avatar on my blog.
Spoiler: I did and you can see the live demo at the bottom of this post.
Options for Displaying Points Link to heading What I want to achieve:
Display 100-2000 points Animate the points to create a dynamic effect Each point should have a color sampled from the original image Have a jittering motion to give a lively appearance Be capable of transitioning between different models smoothly There are several approaches I could take to display points:">

<meta property="og:url" content="https://martinkuzma.github.io/posts/03-avatar-part-2/">
  <meta property="og:site_name" content="Martin&#39;s inner Cosmos">
  <meta property="og:title" content="Pixel avatar Part 2: Displaying points in 3D">
  <meta property="og:description" content="In the previous part, I extracted depth data from a HEIC file taken with an iPhone 15. Now I need to figure out how to display it as a pixelated 3D avatar on my blog.
Spoiler: I did and you can see the live demo at the bottom of this post.
Options for Displaying Points Link to heading What I want to achieve:
Display 100-2000 points Animate the points to create a dynamic effect Each point should have a color sampled from the original image Have a jittering motion to give a lively appearance Be capable of transitioning between different models smoothly There are several approaches I could take to display points:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-14T13:00:00+02:00">
    <meta property="article:modified_time" content="2025-12-14T13:00:00+02:00">
      <meta property="og:see_also" content="https://martinkuzma.github.io/posts/02-avatar-part-1/">




<link rel="canonical" href="https://martinkuzma.github.io/posts/03-avatar-part-2/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css" integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 
  
    
    <link rel="stylesheet" href="/css/custom.min.eb65a8f05f46da75bcc45d76260ab1b4765cd4f76975a4136e65e750d12986e9.css" integrity="sha256-62Wo8F9G2nW8xF12JgqxtHZc1PdpdaQTbmXnUNEphuk=" crossorigin="anonymous" media="screen" />
  





<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://martinkuzma.github.io/">
      Martin&#39;s inner Cosmos
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
         
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://martinkuzma.github.io/posts/03-avatar-part-2/">
              Pixel avatar Part 2: Displaying points in 3D
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-12-14T13:00:00&#43;02:00">
                December 14, 2025
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              7-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/pixel-avatar/">Pixel Avatar</a></div>

          
        </div>
      </header>

      <div class="post-content">
        <p>In the previous part, I extracted depth data from a HEIC file taken with an iPhone 15. Now I need to figure out how to display it as a pixelated 3D avatar on my blog.</p>
<p>Spoiler: I did and you can see the <a href="#live-demo" >live demo</a> at the bottom of this post.</p>
<h2 id="options-for-displaying-points">
  Options for Displaying Points
  <a class="heading-link" href="#options-for-displaying-points">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>What I want to achieve:</p>
<ul>
<li>Display 100-2000 points</li>
<li>Animate the points to create a dynamic effect</li>
<li>Each point should have a color sampled from the original image</li>
<li>Have a jittering motion to give a lively appearance</li>
<li>Be capable of transitioning between different models smoothly</li>
</ul>
<p>There are several approaches I could take to display points:</p>
<table>
  <thead>
      <tr>
          <th>Approach</th>
          <th>Pros</th>
          <th>Cons</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>WebGL</td>
          <td>High performance, fun</td>
          <td>I don&rsquo;t have the time</td>
      </tr>
      <tr>
          <td>Three.js</td>
          <td>High performance, easier to use, tweening and other features</td>
          <td>Large dependency, less fun</td>
      </tr>
      <tr>
          <td>CSS 3D transforms</td>
          <td>No dependencies</td>
          <td>Performance could be an issue</td>
      </tr>
      <tr>
          <td>Pre-rendered animation</td>
          <td>No dependencies, easy, can display anything</td>
          <td>No interactivity, boring as hell, why even bother?</td>
      </tr>
  </tbody>
</table>
<p>Well, looks like Three.js is the best option here. At least this post won&rsquo;t end up being about reinventing matrix multiplications.</p>
<h2 id="displaying-points-with-threejs">
  Displaying Points with Three.js
  <a class="heading-link" href="#displaying-points-with-threejs">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The library provides a lot of examples and features. I was considering using vertices to display points, but I found that the library comes with a built-in type called <code>Sprite</code>, which is perfect for displaying pixelated points. On top of that, sprites are always facing the camera, which is even better.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// Since this is not a THREE.js tutorial, I&#39;ll skip the setup part.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">camera</span>.<span style="color:#a6e22e">position</span>.<span style="color:#a6e22e">z</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">25</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spriteMaterial</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">THREE</span>.<span style="color:#a6e22e">SpriteMaterial</span>({ <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;#FFFFFF&#39;</span> });
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sprite</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">THREE</span>.<span style="color:#a6e22e">Sprite</span>(<span style="color:#a6e22e">spriteMaterial</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sprite</span>.<span style="color:#a6e22e">scale</span>.<span style="color:#66d9ef">set</span>(<span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">0.05</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sprite</span>.<span style="color:#a6e22e">position</span>.<span style="color:#66d9ef">set</span>(
</span></span><span style="display:flex;"><span>        Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">2.0</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1.0</span>, <span style="color:#75715e">// x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">2.0</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1.0</span>, <span style="color:#75715e">// y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">2.0</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1.0</span>, <span style="color:#75715e">// z - this will be set using depth data later
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">scene</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">sprite</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">animate</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">renderer</span>.<span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">scene</span>, <span style="color:#a6e22e">camera</span>);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">renderer</span>.<span style="color:#a6e22e">setAnimationLoop</span>(<span style="color:#a6e22e">animate</span>);
</span></span></code></pre></div><p>Which renders something like this:</p>
<p><img src="/posts/03-avatar-part-2/sprites.png" alt="Three.js Random Sprites" title="Three.js Random Sprites"></p>
<p>Now I need to serialize the depth and color data from the photo, export it as JSON, and load it in the Three.js application.</p>
<h2 id="sampling-points">
  Sampling points
  <a class="heading-link" href="#sampling-points">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>There are two approaches I was considering for sampling points from a photo:</p>
<ul>
<li>Fixed grid: sample points at regular intervals</li>
<li>Random sampling: randomly sample points and then prune</li>
</ul>
<p>I chose random sampling because it gives a more interesting look. Another benefit is that I can easily lower the number of points by taking only a slice of the sampled points without worrying about losing overall shape.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sample_random_values</span>(depth_array, num_samples, min_val<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, max_val<span style="color:#f92672">=</span><span style="color:#ae81ff">255</span>):
</span></span><span style="display:flex;"><span>    all_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([])<span style="color:#f92672">.</span>reshape(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    attempts <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Keep sampling until we have enough points or reach max attempts</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(all_samples) <span style="color:#f92672">&lt;</span> num_samples <span style="color:#f92672">and</span> attempts <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>:
</span></span><span style="display:flex;"><span>        attempts <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Sample random pixel coordinates</span>
</span></span><span style="display:flex;"><span>        x_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(low<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, high<span style="color:#f92672">=</span>depth_array<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>], size<span style="color:#f92672">=</span>num_samples)
</span></span><span style="display:flex;"><span>        y_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>uniform(low<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, high<span style="color:#f92672">=</span>depth_array<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], size<span style="color:#f92672">=</span>num_samples)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Get depth values at sampled coordinates</span>
</span></span><span style="display:flex;"><span>        z_samples <span style="color:#f92672">=</span> depth_array[y_samples<span style="color:#f92672">.</span>astype(int), x_samples<span style="color:#f92672">.</span>astype(int)]
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Combine into (x, y, z) array</span>
</span></span><span style="display:flex;"><span>        sampled_values <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>vstack((x_samples, y_samples, z_samples))<span style="color:#f92672">.</span>T
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Filter samples based on depth range</span>
</span></span><span style="display:flex;"><span>        sampled_values <span style="color:#f92672">=</span> sampled_values[ (sampled_values[:,<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&gt;=</span> min_val) <span style="color:#f92672">&amp;</span> (sampled_values[:,<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&lt;=</span> max_val) ]
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Append to all samples</span>
</span></span><span style="display:flex;"><span>        all_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(all_samples, sampled_values, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Ensure samples are not too close to existing samples</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> point <span style="color:#f92672">in</span> sampled_values:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Compute euclidean distances to existing samples</span>
</span></span><span style="display:flex;"><span>            dists <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt( np<span style="color:#f92672">.</span>sum( (all_samples <span style="color:#f92672">-</span> point)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) )
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Find points that are too close</span>
</span></span><span style="display:flex;"><span>            close_points <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where( (dists <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2.0</span>) <span style="color:#f92672">&amp;</span> (dists <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.0</span>) )[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(close_points) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                all_samples <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>append(all_samples, [point], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Return only the requested number of samples</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> all_samples[:num_samples]
</span></span></code></pre></div><h2 id="normalizing-and-centering-points">
  Normalizing and Centering Points
  <a class="heading-link" href="#normalizing-and-centering-points">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>To ensure that models fit well and have roughly the same size, I need to normalize and center the points.
Normalization is done based on image dimensions for the X and Y axes, and based on depth values for the Z axis.
Centering is done by subtracting the average position from each point. The average position is simply the average of all X and Y coordinates and represents sort of the &ldquo;center of mass&rdquo; of the model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">normalize_sampled_points</span>(sampled_points, img_width, img_height):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Normalize points to -0.5 to 0.5 range using image dimensions</span>
</span></span><span style="display:flex;"><span>    aspect_ratio <span style="color:#f92672">=</span> img_width <span style="color:#f92672">/</span> img_height
</span></span><span style="display:flex;"><span>    sampled_points[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (sampled_points[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">/</span> img_width <span style="color:#f92672">*</span> aspect_ratio) <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>    sampled_points[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (sampled_points[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">/</span> img_height) <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.5</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Normalize Z axis to -0.5 to 0.5 range</span>
</span></span><span style="display:flex;"><span>    min_z <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>min(sampled_points[:, <span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>    max_z <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>max(sampled_points[:, <span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>    move_z <span style="color:#f92672">=</span> ((max_z <span style="color:#f92672">+</span> min_z) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.0</span>) <span style="color:#f92672">/</span> max_z
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    sampled_points[:, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> ((sampled_points[:, <span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> max_z) <span style="color:#f92672">-</span> move_z
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Center points around origin by subtracting average position</span>
</span></span><span style="display:flex;"><span>    avg_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>average(sampled_points[:,<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    avg_y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>average(sampled_points[:,<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>    sampled_points[:,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> sampled_points[:,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> avg_x
</span></span><span style="display:flex;"><span>    sampled_points[:,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> sampled_points[:,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> avg_y
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Invert axis for correct orientation</span>
</span></span><span style="display:flex;"><span>    sampled_points[:, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">*=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sampled_points
</span></span></code></pre></div><h2 id="displaying-exported-data">
  Displaying Exported Data
  <a class="heading-link" href="#displaying-exported-data">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Since I want to keep things simple, I won&rsquo;t use any complex formats for storing 3D models. A simple JSON file is more than enough. I don&rsquo;t want to deal with additional dependencies. Some tweaking was needed to get the right scale and orientation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;p&#34;</span> : [<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.3</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;c&#34;</span>: <span style="color:#e6db74">&#34;#FF00FF&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>Iterating over the points and creating sprites for each of them with specific color is straightforward. I tried it with the photo from the previous post, and here is the result:</p>
<p><img src="/posts/03-avatar-part-2/hand.png" alt="Hand made of sprites" title="Hand made of sprites"></p>
<p>The exported points, however, needed some tweaking. Namely, I had to normalize all axes to fit within a certain range. I also computed the average position to center the model properly.</p>
<h2 id="you-rotate-me-right-round">
  You Rotate Me Right Round
  <a class="heading-link" href="#you-rotate-me-right-round">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Let&rsquo;s add some camera rotation to make it more dynamic. Since sprites in Three.js won&rsquo;t be affected by rotation around the Y axis, I need to rotate the camera&rsquo;s position manually. For that, I can use simple trigonometry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">animate</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">radius</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>; <span style="color:#75715e">// Distance from the center
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rotationSpeed</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.01</span>; <span style="color:#75715e">// Speed of rotation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// CameraRotation is increased over time, it represents the angle in radians
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// DeltaTime is the time elapsed since the last frame, but you already knew that.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">cameraRotation</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cameraRotation</span> <span style="color:#f92672">+</span> (<span style="color:#a6e22e">rotationSpeed</span><span style="color:#f92672">*</span><span style="color:#a6e22e">deltaTime</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">camera</span>.<span style="color:#a6e22e">position</span>.<span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">radius</span> <span style="color:#f92672">*</span> Math.<span style="color:#a6e22e">sin</span>(<span style="color:#a6e22e">cameraRotation</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">camera</span>.<span style="color:#a6e22e">position</span>.<span style="color:#a6e22e">z</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">radius</span> <span style="color:#f92672">*</span> Math.<span style="color:#a6e22e">cos</span>(<span style="color:#a6e22e">cameraRotation</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Always look at the center
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">camera</span>.<span style="color:#a6e22e">lookAt</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">renderer</span>.<span style="color:#a6e22e">render</span>(<span style="color:#a6e22e">scene</span>, <span style="color:#a6e22e">camera</span>);
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p><img src="/posts/03-avatar-part-2/hand_rotating.gif" alt="Rotating Hand" title="Rotating Hand"></p>
<h2 id="tween-baby-tween">
  Tween baby, Tween!
  <a class="heading-link" href="#tween-baby-tween">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>I want to have smooth transitions between different models. Usually, I would try to simulate movement by updating positions in the animation loop. However, for more complex animations with predictable timing and easing functions, it is better to just use a tweening library. I chose <a href="https://github.com/tweenjs/tween.js"  class="external-link" target="_blank" rel="noopener">tween.js</a>.
I mainly focused on the transitioning and jittering motion of some points. Jittering is achieved by randomly offsetting the position of randomly selected points.</p>
<p>Transitioning is quite straightforward too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="color:#75715e">// This code is inside of a method for transitioning between models.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// All points were created beforehand and stored in &#39;this.sprites&#39;. 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// When transitioning, we tween each sprite to its new position and color.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">sprites</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">point</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">points</span>[<span style="color:#a6e22e">i</span>]; <span style="color:#75715e">// New target point from the next model
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sprite</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">sprites</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Tween the new position
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">appearTween</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TWEEN</span>.<span style="color:#a6e22e">Tween</span>( <span style="color:#a6e22e">sprite</span>.<span style="color:#a6e22e">position</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">to</span>( {<span style="color:#a6e22e">y</span>: <span style="color:#66d9ef">point.y</span>, <span style="color:#a6e22e">x</span>: <span style="color:#66d9ef">point.x</span>, <span style="color:#a6e22e">z</span>: <span style="color:#66d9ef">point.z</span>}, <span style="color:#ae81ff">2000</span> ) <span style="color:#75715e">// 2 seconds
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        .<span style="color:#a6e22e">easing</span>( <span style="color:#a6e22e">TWEEN</span>.<span style="color:#a6e22e">Easing</span>.<span style="color:#a6e22e">Circular</span>.<span style="color:#a6e22e">Out</span> )
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">delay</span>( Math.<span style="color:#a6e22e">random</span>()<span style="color:#f92672">*</span><span style="color:#ae81ff">2000</span>) <span style="color:#75715e">// Add random delay 0-2000ms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        .<span style="color:#a6e22e">yoyo</span>( <span style="color:#66d9ef">false</span> )
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">onComplete</span>( () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tweenGroup</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#a6e22e">appearTween</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// This is where we could add jittering after the transition
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        })
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Tween to the new color
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">targetSpriteMaterial</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">SpriteMaterial</span>( { <span style="color:#a6e22e">color</span>: <span style="color:#66d9ef">point.color</span> } );
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">colorTween</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TWEEN</span>.<span style="color:#a6e22e">Tween</span>( <span style="color:#a6e22e">sprite</span>.<span style="color:#a6e22e">material</span>.<span style="color:#a6e22e">color</span> )
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">to</span>( <span style="color:#a6e22e">targetSpriteMaterial</span>.<span style="color:#a6e22e">color</span>, <span style="color:#ae81ff">2000</span> )
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">easing</span>(<span style="color:#a6e22e">TWEEN</span>.<span style="color:#a6e22e">Easing</span>.<span style="color:#a6e22e">Quadratic</span>.<span style="color:#a6e22e">InOut</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">1000</span>) <span style="color:#75715e">// Add random delay 0-1000ms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .<span style="color:#a6e22e">yoyo</span>(<span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Add tweens to the group for updating
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tweenGroup</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">appearTween</span>);            
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tweenGroup</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">colorTween</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="live-demo">
  Live Demo
  <a class="heading-link" href="#live-demo">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div id="avatar-container" style="width: 100%; height: 500px; background-color: #1a1a1a; border-radius: 8px;"></div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    window['3DAvatar'].showModels([
            "3.json", 
            "4.json",
        ],
        {
            pointScale: 0.007,
            nextModelIntervalSeconds: 8,
            cameraDistance: 1.0,
            chanceOfFloatingPoint: 0.2,
        }
    )    
});
</script>
<h2 id="what-could-be-improved">
  What could be improved?
  <a class="heading-link" href="#what-could-be-improved">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>Performance: While this solution works well for a few thousand points, ambitious use-cases would benefit from particle systems or shaders.</li>
<li>Better sampling: Random uniform sampling with depth-check works well, but might produce clusters of points. Poisson disc sampling should yield better results.</li>
<li>Library size: Three.js and tween.js are quite large libraries. The whole avatar library is around 502 KB minified.</li>
<li>Size of JSON files: A binary format could reduce the size of model files significantly.</li>
</ul>
<h2 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>I was able to create the desired pixelated 3D avatar using depth data extracted from an iPhone selfie. The process involved sampling points, exporting them as JSON, and displaying them using Three.js.</p>
<p>You can check out the full source code or even create your own avatar on <a href="https://github.com/MartinKuzma/3D-web-avatar"  class="external-link" target="_blank" rel="noopener">GitHub</a></p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
  
</section>


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2025 -
    
    2026
     Martin Kuzma 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  
  
  
  <script src="/js/3davatar.min.min.2e81f5f9f345b4ca27f94e6663ed9df413fde4ddcd929930098f0a8a76f09365.js" integrity="sha256-LoH1&#43;fNFtMon&#43;U5mY&#43;2d9BP95N3NkpkwCY8Kinbwk2U="></script>
  
  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
